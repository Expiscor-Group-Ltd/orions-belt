{# SPDX-License-Identifier: MIT
# Copyright (c) 2024 Marko Sarunac
#
# Part of the Orion's Belt project.
# Repository: https://github.com/Expiscor-Group-Ltd/orions-belt
# Template ID: OB-007-T

# Fail2ban Configuration
# Generated by Ansible Security Hardening Playbook
# Applied: {{ ansible_date_time.iso8601 }}

[DEFAULT]
# Ban hosts for 1 hour
bantime = 3600
# Check for 10 minutes
findtime = 600
# Allow 3 failures
maxretry = 3
# Ban action
banaction = iptables-allports
# Log level
loglevel = INFO
# Log target
logtarget = /var/log/fail2ban.log

# SSH protection
[sshd]
enabled = true
port = ssh
filter = sshd
logpath = /var/log/auth.log
maxretry = 3
bantime = 3600

# SSH protection (dropbear)
[dropbear]
enabled = true
port = ssh
filter = dropbear
logpath = /var/log/auth.log
maxretry = 3
bantime = 3600

# Apache protection - dynamic log detection
[apache-auth]
enabled = true
port = http,https
filter = apache-auth
logpath = /var/log/apache2/*error*.log
maxretry = 3
bantime = 3600

# Apache bad bots
[apache-badbots]
enabled = true
port = http,https
filter = apache-badbots
logpath = /var/log/apache2/*access*.log
maxretry = 2
bantime = 3600

# Apache overflows
[apache-overflows]
enabled = true
port = http,https
filter = apache-overflows
logpath = /var/log/apache2/*error*.log
maxretry = 2
bantime = 3600

# Apache shellshock
[apache-shellshock]
enabled = true
port = http,https
filter = apache-shellshock
logpath = /var/log/apache2/*error*.log
maxretry = 1
bantime = 3600

# Nginx protection - dynamic log detection
[nginx-http-auth]
enabled = true
port = http,https
filter = nginx-http-auth
logpath = /var/log/nginx/*error*.log
maxretry = 3
bantime = 3600

# Nginx bad bots
[nginx-badbots]
enabled = true
port = http,https
filter = nginx-badbots
logpath = /var/log/nginx/*access*.log
maxretry = 2
bantime = 3600

# Nginx limit requests
[nginx-limit-req]
enabled = true
port = http,https
filter = nginx-limit-req
logpath = /var/log/nginx/*error*.log
maxretry = 3
bantime = 3600

# PHP-FPM protection
[php-url-fopen]
enabled = true
port = http,https
filter = php-url-fopen
logpath = /var/log/apache2/*error*.log
maxretry = 1
bantime = 3600

# Wordpress protection
[wordpress]
enabled = true
port = http,https
filter = wordpress
logpath = /var/log/apache2/*error*.log
maxretry = 3
bantime = 3600

# Drupal protection
[drupal]
enabled = true
port = http,https
filter = drupal
logpath = /var/log/apache2/*error*.log
maxretry = 3
bantime = 3600

# Joomla protection
[joomla]
enabled = true
port = http,https
filter = joomla
logpath = /var/log/apache2/*error*.log
maxretry = 3
bantime = 3600

# MySQL protection
[mysql-auth]
enabled = true
port = 3306
filter = mysql-auth
logpath = /var/log/mysql/*error*.log
maxretry = 3
bantime = 3600

# PostgreSQL protection
[postgresql]
enabled = true
port = 5432
filter = postgresql
logpath = /var/log/postgresql/*.log
maxretry = 3
bantime = 3600

# FTP protection
[vsftpd]
enabled = true
port = ftp,ftp-data,ftps,ftps-data
filter = vsftpd
logpath = /var/log/vsftpd.log
maxretry = 3
bantime = 3600

# Pure-FTPd protection
[pure-ftpd]
enabled = true
port = ftp,ftp-data,ftps,ftps-data
filter = pure-ftpd
logpath = /var/log/syslog
maxretry = 3
bantime = 3600

# Mail protection
[postfix]
enabled = true
port = smtp,465,submission
filter = postfix
logpath = /var/log/mail.log
maxretry = 3
bantime = 3600

# Dovecot protection
[dovecot]
enabled = true
port = pop3,pop3s,imap,imaps
filter = dovecot
logpath = /var/log/mail.log
maxretry = 3
bantime = 3600

# Recidive (repeat offenders)
[recidive]
enabled = true
filter = recidive
logpath = /var/log/fail2ban.log
maxretry = 5
bantime = 604800  # 1 week
findtime = 86400   # 1 day 